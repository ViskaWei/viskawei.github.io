---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import { clusters } from '../data/skilltree';
import '../styles/skilltree.css';
---

<BaseLayout title="Skill Galaxy — Viska Wei" description="Interactive galaxy visualization of academic skills and knowledge">
  <div class="galaxy-page">
    <Nav />

    <div class="galaxy-container" id="galaxy-root">
      <!-- Sidebar: cluster navigation + XP -->
      <aside class="galaxy-sidebar">
        <div class="sidebar-title">Skill Galaxy</div>
        <div class="sidebar-subtitle">// from stardust to circuits</div>

        {clusters.map(cluster => (
          <button
            class="cluster-nav-btn"
            data-cluster={cluster.id}
            style={`--cluster-color: ${cluster.color}`}
          >
            <span class="cluster-dot"></span>
            <span>{cluster.label}</span>
            <span class="cluster-count">0</span>
          </button>
        ))}

        <div class="xp-section">
          <div class="xp-header">
            <span class="xp-level">LVL 0</span>
            <span class="xp-rank">Stargazer</span>
          </div>
          <div class="xp-bar-track">
            <div class="xp-bar-fill" style="width: 0%"></div>
          </div>
          <div class="xp-value">0 / 100 XP</div>
        </div>
      </aside>

      <!-- Standard detail panel (courses/regular nodes) -->
      <div class="galaxy-detail-panel">
        <button class="close-btn" aria-label="Close">&times;</button>
        <h3>Node Name</h3>
        <div class="detail-code">CODE</div>
        <div class="detail-meta">
          <span class="detail-institution-badge">JHU</span>
          <span class="detail-year">2023</span>
        </div>
        <span class="detail-grade">A+</span>
        <div class="detail-type">COURSE</div>
        <div class="detail-track">Physics</div>

        <div class="detail-prereqs detail-section">
          <h4>Prerequisites</h4>
          <div class="detail-list"></div>
        </div>

        <div class="detail-projects detail-section">
          <h4>Related Projects</h4>
          <div class="detail-list"></div>
        </div>
      </div>

      <!-- Star Gate detail panel (top projects — fly-in view) -->
      <div class="stargate-detail-panel">
        <button class="sg-close-btn" aria-label="Close">&times;</button>
        <div class="sg-header">
          <div class="sg-type">[ THESIS ]</div>
          <h2 class="sg-title">Project Name</h2>
          <div class="sg-venue"></div>
          <div class="sg-year"></div>
        </div>
        <div class="sg-links"></div>
        <div class="sg-stack-section">
          <div class="sg-stack-label">TECH STACK PATH</div>
          <div class="sg-stack"></div>
        </div>
      </div>

      <!-- Legend -->
      <div class="galaxy-legend">
        <div class="legend-item">
          <span class="legend-hypergiant"></span>
          Hypergiant (A+)
        </div>
        <div class="legend-item">
          <span class="legend-main-seq"></span>
          Main Seq (A/A-)
        </div>
        <div class="legend-item">
          <span class="legend-brown-dwarf"></span>
          Brown Dwarf (B+)
        </div>
        <div class="legend-item">
          <span class="legend-ghost"></span>
          Ghost / Locked
        </div>
        <div class="legend-item">
          <span class="legend-stargate"></span>
          Star Gate
        </div>
        <div class="legend-item">
          <span class="legend-dyson"></span>
          Thesis (Dyson)
        </div>
        <div class="legend-item">
          <span class="legend-crystal"></span>
          Publication (Crystal)
        </div>
        <div class="legend-item">
          <span class="legend-edge-line"></span>
          Connection
        </div>
      </div>

      <!-- Zoom controls -->
      <div class="galaxy-zoom-controls">
        <button class="zoom-in" aria-label="Zoom in">+</button>
        <button class="zoom-out" aria-label="Zoom out">&minus;</button>
        <button class="zoom-reset" aria-label="Reset zoom">&#8634;</button>
      </div>
    </div>

    <Footer />
  </div>
</BaseLayout>

<script>
  import { initGalaxyView } from '../islands/GalaxyView';
  import { courses, projectNodes, tracks } from '../data/techtree';
  import { projects } from '../data/projects';

  // Expose project data for Star Gate link resolution
  (window as any).__galaxyProjects = projects;

  const container = document.getElementById('galaxy-root');
  if (container) {
    initGalaxyView(container, courses, projectNodes, tracks);
  }
</script>
